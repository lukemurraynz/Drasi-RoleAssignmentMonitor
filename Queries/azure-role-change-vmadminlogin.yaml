kind: ContinuousQuery
apiVersion: v1
name: azure-role-change-vmadminlogin
spec:
  mode: query
  sources:
    subscriptions:
      - id: azure-role-eventhub-source
        nodes:
          - sourceLabel: eventhub1
        pipeline:
          - extract-role-assignments
    middleware:
      - name: extract-role-assignments
        kind: unwind
        eventhub1:        
          - selector: $.records[*]
            label: RoleAssignment
            key: $.correlationId
  query: |
    MATCH (r:RoleAssignment)
    RETURN r.properties.requestbody AS eventcategory,
     r.correlationId AS correlationId